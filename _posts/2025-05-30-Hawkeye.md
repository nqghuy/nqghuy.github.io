---
title: "Hawkeye - Malware Network Traffic Analysis"
date: 2025-07-04 12:00:00 +0700
categories: [CTF, Network Forensics]
tags: [wireshark, malware, smtp, data-exfiltration, pcap]
image:
  path: /assets/img/posts/Hawkeye/banner.png
  alt: Hawkeye Lab
---
## Giới thiệu

**Difficulty**: Easy  
**Category**: Network  
**Tools**: Wireshark

Bài lab phân tích network traffic để phát hiện malware và data exfiltration.

## Q1: How many packets does the capture have?
Quá dễ rồi. Bonus thêm từ đáp án chính thức:
A large number of packets in a short duration might suggest automated activity, such as malware beaconing or data exfiltration, whereas a low packet count might indicate a short-lived intrusion attempt.

## Q2: At what time was the first packet captured?
Tiếp tục là quá dễ
## Q3: What is the duration of the capture?

![image.png](/assets/img/posts/Hawkeye/image.png)

## Q4: What is the most active computer at the link level?

The first three octets of a MAC address, we can determine the manufacturer of the NIC and gain insight into the device type

![image.png](/assets/img/posts/Hawkeye/image%201.png)

## Q5: Manufacturer of the NIC of the most active system at the link level?

![image.png](/assets/img/posts/Hawkeye/image%202.png)

## Q6: Where is the headquarter of the company that manufactured the NIC of the most active computer at the link level?

Tra google

## Q7: The organization works with private addressing and netmask /24. How many computers in the organization are involved in the capture?

![image.png](/assets/img/posts/Hawkeye/image%203.png)

→ 3 trừ broadcast

## Q8: What is the name of the most active computer at the network level?

sử dụng dhcp

![image.png](/assets/img/posts/Hawkeye/image%204.png)

## Q9: What is the IP of the organization's DNS server?

![image.png](/assets/img/posts/Hawkeye/image%205.png)

dùng filter dns, ta thấy ngoài ip 10.4.10.132 thì ip 10.4.10.4 hoat động mạnh

## Q10: What domain is the victim asking about in packet 204?

### Cách 1

sử dụng filter dns

![image.png](/assets/img/posts/Hawkeye/image%206.png)

nhận thấy ip 10.4.10.132 truy cập vào website độc hại (trên virustotal)

hoặc vào http

![image.png](/assets/img/posts/Hawkeye/image%207.png)

## Q17: What is the public IP address of the victim?

- **Mục tiêu:** Xác định **địa chỉ IP công cộng** của máy nạn nhân (public IP).
- **Lý do:** Public IP giúp kẻ tấn công biết nạn nhân đang ở đâu, dùng mạng gì, và có thể đánh giá mức độ bảo vệ (firewall, mạng công ty hay cá nhân).
- **Cách hoạt động:** Sau khi máy bị nhiễm mã độc, phần mềm độc hại thường tự gửi một **HTTP request** đến các dịch vụ "what is my IP" (như `bot.whatismyipaddress.com`) để lấy địa chỉ IP công cộng của chính nó.
- **Phát hiện:** Trong Wireshark, thấy máy nạn nhân gửi yêu cầu GET tới `bot.whatismyipaddress.com`, và server trả về địa chỉ IP công cộng là `173.66.146.112`.
- **Ý nghĩa:** Địa chỉ này có thể bị mã độc gửi về server của kẻ tấn công, giúp chúng biết vị trí và loại mạng của nạn nhân để tiếp tục tấn công, quản lý botnet hoặc vượt qua giới hạn vùng địa lý.

## Q19: Analyzing the first extraction of information. What software runs the email server to which the stolen data is sent?

**SMTP banner** là thông điệp mà **mail server** gửi cho client ngay khi bắt đầu phiên kết nối SMTP.

- Khi một client (ví dụ: phần mềm gửi email hoặc máy chủ khác) kết nối đến cổng SMTP (thường là port 25), server sẽ trả về một **chuỗi chào mừng**.
- Chuỗi này thường chứa:
    - **Tên server hoặc hostname**
    - **Phiên bản phần mềm MTA (Mail Transfer Agent)** đang chạy
    - Đôi khi là thông tin khác (thông báo, cảnh báo, v.v.)

![image.png](/assets/img/posts/Hawkeye/image%208.png)

## Q21: Why is the password transmitted in plaintext dangerous?

- **Mật khẩu của malware được truyền dưới dạng plaintext** trong traffic SMTP → chứng tỏ email **không dùng cơ chế bảo mật** như **TLS hoặc SSL**.
- **Nguy cơ:**
    - Dễ bị **network security tools** (IDS/IPS, packet sniffer) hoặc **kẻ tấn công MITM (man-in-the-middle)** chặn và đánh cắp.
- **Nguyên nhân:**
    - Mail server của kẻ tấn công bị **cấu hình sai hoặc cố tình tắt mã hóa**.
    - Các dịch vụ email hiện đại thường **bắt buộc mã hóa** để tránh rò rỉ mật khẩu.

## Q24: Every how many minutes does the collected data get exfiltrated?

![image.png](/assets/img/posts/Hawkeye/image%209.png)

**`EHLO`** là một lệnh trong giao thức **SMTP (Simple Mail Transfer Protocol)**.

- Nó được dùng khi **client** (ví dụ: phần mềm gửi email hoặc malware) **bắt đầu phiên kết nối** với mail server.
- `EHLO` là phiên bản mở rộng của lệnh `HELO`, được giới thiệu trong **Extended SMTP (ESMTP)**.

**Tóm lại:**

- `EHLO` giống như "Xin chào, tôi là [tên máy], bạn hỗ trợ những tính năng nào?".
- Nó giúp client biết server có hỗ trợ **xác thực, mã hóa (STARTTLS)** hay các tính năng mở rộng khác không.

## Tham khảo

- [Wireshark Documentation](https://www.wireshark.org/docs/)
-